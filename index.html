const XLSX = require("xlsx");
const fs = require("fs");

// --------------------------------------------------
// 1. CONFIG â€” only show these columns
// --------------------------------------------------
const allowedColumns = ["Name", "Age", "Email"];  
// Replace with your column headers

// --------------------------------------------------
// 2. LOAD WORKBOOK
// --------------------------------------------------
const workbook = XLSX.readFile("input.xlsx");
const sheetName = workbook.SheetNames[0];
const sheet = workbook.Sheets[sheetName];

// Convert entire sheet to JSON (array of row objects)
const data = XLSX.utils.sheet_to_json(sheet);

// --------------------------------------------------
// 3. FILTER COLUMNS
// --------------------------------------------------
const filteredData = data.map(row => {
  let filteredRow = {};
  for (const col of allowedColumns) {
    filteredRow[col] = row[col] ?? ""; // ensure missing columns don't break HTML
  }
  return filteredRow;
});

// --------------------------------------------------
// 4. BUILD HTML TABLE
// --------------------------------------------------
function buildHtmlTable(rows) {
  let html = `<table border="1" cellspacing="0" cellpadding="5">\n`;

  // Header
  html += "  <tr>\n";
  for (const col of allowedColumns) {
    html += `    <th>${col}</th>\n`;
  }
  html += "  </tr>\n";

  // Body rows
  rows.forEach(row => {
    html += "  <tr>\n";
    for (const col of allowedColumns) {
      html += `    <td>${row[col] || ""}</td>\n`;
    }
    html += "  </tr>\n";
  });

  html += "</table>\n";
  return html;
}

const htmlTable = buildHtmlTable(filteredData);

// --------------------------------------------------
// 5. WRITE OUTPUT FILE
// --------------------------------------------------
fs.writeFileSync("output.html", htmlTable, "utf8");

console.log("HTML table created: output.html");
