<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Production Dashboard TV</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"/>

<!-- jQuery and DataTables -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
html, body {
  height: 100%;
  margin: 0;
  background-color: #f8f9fa;
  font-family: Arial, sans-serif;
}

.container-fluid {
  height: 100%;
  display: flex;
  flex-direction: column;
  padding: 10px;
}

.header-section {
  flex: 0 0 auto;
  text-align: center;
}

.header-section h1 {
  font-size: 3rem; /* large for TV */
  margin-bottom: 10px;
}

.clocks iframe {
  width: 100%;
  max-height: 120px;
  margin-bottom: 5px;
}

.table-section {
  flex: 1 1 auto; /* takes remaining space */
  overflow-y: auto;
}

table {
  font-size: 1.5rem; /* readable on TV */
}
</style>
</head>
<body>

<div class="container-fluid">
  <!-- Header + clocks -->
  <div class="header-section">
    <div class="clocks mb-2">
      <iframe src="https://free.timeanddate.com/clock/ia4vsg4z/n250/tlca/fs72/ftb/pa10/tt1/tm1" frameborder="0"></iframe>
      <iframe src="https://free.timeanddate.com/clock/ia4vsg4z/n250/tlca/fs132/ftb/" frameborder="0"></iframe>
    </div>
    <h1>Medium Duty Production Dashboard</h1>
    <input type="file" id="fileInput" class="form-control mb-2" accept=".xlsx">
  </div>

  <!-- Table -->
  <div class="table-section">
    <div id="output"></div>
  </div>
</div>

<script>
const hiddenColumnIndexes = [7, 8];  // example
const checkColumnIndex = 5;

document.getElementById("fileInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(event){
    const data = new Uint8Array(event.target.result);
    const workbook = XLSX.read(data, { type: 'array' });

    const sheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[sheetName];

    let rows = XLSX.utils.sheet_to_json(worksheet, { header:1 });

    // Remove rows if column 5 empty
    rows = rows.filter(row => {
      const value = row[checkColumnIndex];
      return value !== undefined && value !== null && value !== "";
    });

    // Hide unwanted columns
    rows = rows.map(row => row.filter((_, colIndex) => !hiddenColumnIndexes.includes(colIndex)));

    // Convert to sheet â†’ HTML
    const html = XLSX.utils.sheet_to_html(XLSX.utils.aoa_to_sheet(rows));

    const tempDiv = document.createElement("div");
    tempDiv.innerHTML = html;
    const table = tempDiv.querySelector("table");
    table.classList.add("table", "table-striped", "table-bordered", "table-hover");

    document.getElementById("output").innerHTML = tempDiv.innerHTML;

    // Initialize DataTables
    $(document).ready(function(){
      $('#output table').DataTable({
        paging: true,
        searching: true,
        info: false,
        scrollY: $('.table-section').height() + "px",
        scrollCollapse: true,
        scrollX: false,
        responsive: true
      });
    });
  };
  reader.readAsArrayBuffer(file);
});

// Adjust DataTables scroll on window resize
window.addEventListener('resize', () => {
  const dt = $('#output table').DataTable();
  if(dt){
    dt.settings()[0].oScroll.sY = $('.table-section').height() + "px";
    dt.draw(false);
  }
});
</script>

</body>
</html>
